

# ğŸ“˜ RePaint: Inpainting using Denoising Diffusion Probabilistic Models

## 1. ê°œìš” (Overview)

* **ì œëª©**: RePaint: Inpainting using Denoising Diffusion Probabilistic Models
* **ì €ì**: Andreas Lugmayr, Martin Danelljan, Andres Romero, Fisher Yu, Radu Timofte, Luc Van Gool
* **ì†Œì†**: ETH Zurich (Computer Vision Lab)
* **í•™íšŒ**: CVPR 2022 (Extended Version)
* **ë§í¬**: [arXiv:2201.09865] / [GitHub: git.io/RePaint]

> **ì„ ì • ì´ìœ  & ë„ì…**: ê¸°ì¡´ inpaintingì€ â€œíŠ¹ì • mask ë¶„í¬ë¡œ í•™ìŠµëœ ì¡°ê±´ë¶€ ëª¨ë¸â€ì— ì˜ì¡´í•´ **ë³´ì§€ ëª»í•œ maskì— ì•½í•¨** + pixel/perceptual loss ê¸°ë°˜ í•™ìŠµì´ **í…ìŠ¤ì²˜ ë³µì‚¬/ì—°ì¥**ì— ì¹˜ìš°ì¹˜ê¸° ì‰¬ì›€. RePaintëŠ” **í•™ìŠµ ì—†ì´(unconditional pretrained DDPM ê·¸ëŒ€ë¡œ)**, **sampling(ì—­í™•ì‚°) ê³¼ì •ë§Œ ìˆ˜ì •**í•´ì„œ ì–´ë–¤ maskì—ë„ ì ìš©ë˜ëŠ” â€œë§ˆìŠ¤í¬-ë¹„ì˜ì¡´â€ inpaintingì„ ëª©í‘œë¡œ í•¨.

---

## 2. ë¬¸ì œ ì •ì˜ (Problem Formulation)

**ë¬¸ì œ ë° ê¸°ì¡´ í•œê³„**:

* (1) ëŒ€ë¶€ë¶„ì˜ inpainting ëª¨ë¸ì€ **mask ë¶„í¬ì— ë§ì¶° í•™ìŠµ** â†’ maskê°€ ë°”ë€Œë©´ ì¼ë°˜í™”ê°€ ê¹¨ì§
* (2) ì†ì‹¤ ì„¤ê³„(í”½ì…€/ì§€ê° ì†ì‹¤)ë¡œ ì¸í•´ **ì˜ë¯¸ë¡ ì  ìƒì„±**ë³´ë‹¤ **ì£¼ë³€ í…ìŠ¤ì²˜ í™•ì¥**ìœ¼ë¡œ ìˆ˜ë ´í•˜ê¸° ì‰¬ì›€

**ì œì•ˆ ë°©ì‹**:

* **Unconditional DDPMì„ priorë¡œ ì‚¬ìš©**í•˜ê³ , **ë„¤íŠ¸ì›Œí¬ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ**
* ì—­í™•ì‚° ê° stepì—ì„œ

  * **known(ë¹„ë§ˆìŠ¤í¬) ì˜ì—­ì€ ì…ë ¥ ì´ë¯¸ì§€ xâ‚€ë¥¼ â€œí•´ë‹¹ tì— ë§ê²Œ ë…¸ì´ì¦ˆ ì„ì–´â€ ìƒ˜í”Œë§**
  * **unknown(ë§ˆìŠ¤í¬) ì˜ì—­ì€ DDPM ì—­í™•ì‚° ìƒ˜í”Œë§**
  * ë‘˜ì„ maskë¡œ í•©ì„± â†’ â€œì¡°ê±´ë¶€ ìƒì„±â€ì„ **sampling ë ˆë²¨**ì—ì„œ êµ¬í˜„
* ì¶”ê°€ë¡œ, ê²½ê³„/ì¡°í™”(harmonization)ë¥¼ ìœ„í•´ **resampling(ì•ìœ¼ë¡œ ê°”ë‹¤ê°€ ë‹¤ì‹œ ë’¤ë¡œ ì˜¤ëŠ” í™•ì‚°ì‹œê°„ ì™•ë³µ)** ìŠ¤ì¼€ì¤„ì„ ë„ì…

> â€» **í•µì‹¬ ê°œë… ì •ì˜**
>
> * **DDPM prior**: ë°ì´í„° ë¶„í¬ë¥¼ ì˜ í•™ìŠµí•œ unconditional ìƒì„±ê¸°(ë…¸ì´ì¦ˆâ†’ì´ë¯¸ì§€)
> * **Mask-agnostic conditioning**: ëª¨ë¸ì„ ì¡°ê±´ë¶€ë¡œ ì¬í•™ìŠµí•˜ì§€ ì•Šê³ , â€œknown í”½ì…€ì„ ë§¤ step ê°•ì œ ì£¼ì…â€í•˜ì—¬ ì¡°ê±´ì„ ê±°ëŠ” ë°©ì‹
> * **Resampling / Jump schedule**: í•œ stepì—ì„œ ë°”ë¡œ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ì§€ ì•Šê³ , **(tâ†’t-1) í›„ (t-1â†’t)ë¡œ ë‹¤ì‹œ í™•ì‚°**í•´ ê²½ê³„ë¥¼ ë” ì˜¤ë˜ ì¡°í™”ì‹œí‚¤ëŠ” ì „ëµ(ë” ì¼ë°˜ì ìœ¼ë¡œëŠ” jump lengthë§Œí¼ ì™•ë³µ)

---

## 3. ëª¨ë¸ êµ¬ì¡° (Architecture)

### ì „ì²´ êµ¬ì¡°

![ëª¨ë¸ êµ¬ì¡°](Fig.2 / Algorithm 1)

* ì…ë ¥: ì›ë³¸ ì´ë¯¸ì§€ (x_0), ë°”ì´ë„ˆë¦¬ ë§ˆìŠ¤í¬ (m) (ë…¼ë¬¸ í‘œê¸°ìƒ **known/unknown ë§ˆìŠ¤í¬ ì •ì˜ëŠ” ë¬¸ë§¥ì— ë”°ë¼ ì£¼ì˜**)
* ìƒ˜í”Œë§ì€ (x_T \sim \mathcal{N}(0, I))ì—ì„œ ì‹œì‘í•´ (t=T\to1)ë¡œ ì—­í™•ì‚°
* ë§¤ stepì—ì„œ **known ì˜ì—­ì€ â€œì •ë‹µ í”½ì…€ ê¸°ë°˜ ìƒ˜í”Œâ€ë¡œ ë®ì–´ì“°ê¸°**, unknown ì˜ì—­ë§Œ DDPMì´ ìƒì„±

---

### ğŸ’  í•µì‹¬ ëª¨ë“ˆ ë˜ëŠ” êµ¬ì„± ìš”ì†Œ

#### ğŸ“Œ (A) Known-region Injection (ì¡°ê±´ ì£¼ì…: Eq. 8)

**ì•„ì´ë””ì–´**: ì—­í™•ì‚°ì€ (x_t)ë§Œ ë³´ë©´ ë˜ë¯€ë¡œ, (x_t)ì˜ known ë¶€ë¶„ì„ â€œë¶„í¬ ê°€ì •ì— ë§ê²Œâ€ êµì²´í•´ë„ ëœë‹¤.
Forward noising ì„±ì§ˆë¡œ (x_0)ì—ì„œ ì›í•˜ëŠ” (x_t)ë¥¼ í•œ ë²ˆì— ìƒ˜í”Œë§ ê°€ëŠ¥:

```math
q(x_t|x_0)=\mathcal{N}(\sqrt{\bar{\alpha}_t}x_0,\ (1-\bar{\alpha}_t)I)
```

ì´ê±¸ ì´ìš©í•´ì„œ known ì˜ì—­ì€ ì…ë ¥ (x_0)ì—ì„œ ìƒ˜í”Œ, unknown ì˜ì—­ì€ DDPM ì—­í™•ì‚° ìƒ˜í”Œì„ ì‚¬ìš©:

```math
x_{t-1}^{known} \sim \mathcal{N}(\sqrt{\bar{\alpha}_t}x_0,\ (1-\bar{\alpha}_t)I)
```

```math
x_{t-1}^{unknown} \sim \mathcal{N}(\mu_\theta(x_t,t),\ \Sigma_\theta(x_t,t))
```

```math
x_{t-1}= m\odot x_{t-1}^{known} + (1-m)\odot x_{t-1}^{unknown}
```

> í¬ì¸íŠ¸: **â€œí•™ìŠµëœ ì¡°ê±´ë¶€ ë„¤íŠ¸ì›Œí¬â€ê°€ ì•„ë‹ˆë¼ â€œë¶„í¬ì ìœ¼ë¡œ íƒ€ë‹¹í•œ known ìƒ˜í”Œì„ ë§¤ step ì£¼ì…â€**í•´ì„œ ì¡°ê±´ì„ ë§Œì¡±ì‹œí‚´.

---

#### ğŸ“Œ (B) RePaint Resampling (ì¡°í™” ê°œì„ : Algorithm 1 + Jump schedule)

**ë¬¸ì œ(ì™œ í•„ìš”?)**: (A)ë§Œ ì“°ë©´ í…ìŠ¤ì²˜ëŠ” ë§ëŠ”ë° **ì˜ë¯¸ë¡ ì´ í‹€ë¦¬ê±°ë‚˜**, ê²½ê³„ê°€ ì–´ìƒ‰í•œ ê²½ìš°ê°€ ë§ìŒ.
ì›ì¸: known ì˜ì—­ ìƒ˜í”Œë§ì€ ìƒì„±ëœ unknown ì˜ì—­ì„ ê³ ë ¤í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë§¤ stepë§ˆë‹¤ **disharmonyê°€ ì¬ì£¼ì…**ë˜ê³ , ë’¤ë¡œ ê°ˆìˆ˜ë¡ (\beta_t)ê°€ ì‘ì•„ì ¸ **í° ìˆ˜ì •ì´ ì–´ë ¤ì›Œ** ì¡°í™”ê°€ ì¶©ë¶„íˆ ì•ˆ ë¨.

**í•´ê²°(í•µì‹¬)**: í•œ stepì—ì„œ ë°”ë¡œ ë‹¤ìŒìœ¼ë¡œ ê°€ì§€ ë§ê³ , **ì—­í™•ì‚°ìœ¼ë¡œ ë§Œë“  (x_{t-1})**ë¥¼ ë‹¤ì‹œ **ì •ë°©í–¥ í™•ì‚°(ë…¸ì´ì¦ˆ ì¶”ê°€)**í•´ì„œ (x_t)ë¡œ ë˜ëŒë¦° ë’¤, ë‹¤ì‹œ ì—­í™•ì‚°ì„ ë°˜ë³µ â†’ ê²½ê³„ë¥¼ ë” ì˜¤ë˜ â€œì„ê³  ë§ì¶”ëŠ”â€ ì‹œê°„ í™•ë³´.

Algorithm 1ì˜ ë‚´ë¶€ ë£¨í”„(Resampling íšŸìˆ˜ (U)ë²ˆ)ê°€ ì´ êµ¬ì¡°:

* (t) ê³ ì • ìƒíƒœì—ì„œ

  1. (x_{t-1}) ìƒì„±(known ì£¼ì… + unknown DDPM)
  2. ì•„ì§ resample ë‚¨ì•˜ìœ¼ë©´, **ì •ë°©í–¥ í™•ì‚°ìœ¼ë¡œ (x_t)ë¡œ ë˜ëŒë¦¼**
  3. ë‹¤ì‹œ (1) ë°˜ë³µ

ì •ë°©í–¥ í•œ stepì€:

```math
x_t \sim \mathcal{N}(\sqrt{1-\beta_{t-1}}x_{t-1},\ \beta_{t-1}I)
```

**Jump length (j)**: ë‹¨ìˆœíˆ 1-step ì™•ë³µì´ ì•„ë‹ˆë¼, (j) stepë§Œí¼ ì•ìœ¼ë¡œ ê°”ë‹¤ê°€ ë‹¤ì‹œ ë’¤ë¡œ ì˜¤ëŠ” â€œí° ì™•ë³µâ€ì„ ìŠ¤ì¼€ì¤„ë¡œ êµ¬ì„± (Appendixì˜ time schedule pseudo-code).
ê²°ê³¼ì ìœ¼ë¡œ í™•ì‚° ì‹œê°„ (t)ê°€ ë‹¨ì¡° ê°ì†Œê°€ ì•„ë‹ˆë¼ **ìœ„ì•„ë˜ë¡œ ì¶œë ì´ë©° ì§„í–‰**(Fig.10).

> ìš”ì•½: RePaintì˜ â€œë¦¬í˜ì¸íŒ…â€ì€ **(known í”½ì…€ ì£¼ì…) + (í™•ì‚°ì‹œê°„ ì™•ë³µ resampling/jump)** ì´ ë‘ ê°€ì§€ê°€ í•µì‹¬.

---

## âš–ï¸ ê¸°ì¡´ ëª¨ë¸ê³¼ì˜ ë¹„êµ

| í•­ëª©    | ë³¸ ë…¼ë¬¸ (RePaint)                        | ê¸°ì¡´ ë°©ë²•1 (GAN inpainting: LaMa ë“±)         | ê¸°ì¡´ ë°©ë²•2 (Autoregressive: ICT/DSI ë“±) |
| ----- | ------------------------------------- | --------------------------------------- | ---------------------------------- |
| êµ¬ì¡°    | **Unconditional DDPM** + sampling ìˆ˜ì •  | ì¡°ê±´ë¶€ GAN ì¸í˜ì¸íŒ… ë„¤íŠ¸ì›Œí¬                       | í† í°/íŒ¨ì¹˜ ê¸°ë°˜ AR ìƒì„±                     |
| í•™ìŠµ ë°©ì‹ | **ì¸í˜ì¸íŒ… í•™ìŠµ ì—†ìŒ**(ì‚¬ì „í•™ìŠµ DDPM ê·¸ëŒ€ë¡œ)         | mask ë¶„í¬ë¥¼ í¬í•¨í•´ í•™ìŠµí•˜ëŠ” ê²½ìš°ê°€ ë§ìŒ                | ë§ˆìŠ¤í¬/í† í° ì‹œë‚˜ë¦¬ì˜¤ì— ë§ì¶˜ í•™ìŠµ                 |
| ì¡°ê±´ ì£¼ì… | **ë§¤ step known ì˜ì—­ì„ ë¶„í¬ì ìœ¼ë¡œ ìƒ˜í”Œë§í•´ ê°•ì œ ì£¼ì…** | ë„¤íŠ¸ì›Œí¬ ì…ë ¥/íŠ¹ìˆ˜ conv(Partial/Gated ë“±)ë¡œ ì¡°ê±´ ë°˜ì˜ | ì¡°ê±´ í† í°/ë§ˆìŠ¤í¬ë¡œ ìƒì„±                      |
| ê°•ì     | mask-agnostic, ë‹¤ì–‘ì„±, ì˜ë¯¸ë¡  ìƒì„± ê°•í•¨         | ë¹ ë¦„, íŠ¹ì • ë§ˆìŠ¤í¬/ë„ë©”ì¸ì—ì„œ ê°•í•¨                     | êµ¬ì¡°ì  ì¼ê´€ì„±/ë‹¤ì–‘ì„± ê°€ëŠ¥                     |
| ì•½ì     | ìƒ˜í”Œë§ ë¹„ìš© í¼, ë°ì´í„° ë°”ì´ì–´ìŠ¤ ì˜í–¥                 | ë³´ì§€ ëª»í•œ maskì— ì·¨ì•½ ê°€ëŠ¥                       | ê¸´ ìƒì„±/ë³µì¡ë„, í•™ìŠµ ì˜ì¡´                    |

---

## ğŸ“‰ ì‹¤í—˜ ë° ê²°ê³¼

* **ë°ì´í„°ì…‹**: CelebA-HQ, ImageNet (ì¶”ê°€ë¡œ Places2 ë¶„ì„)
* **ë¹„êµ ëª¨ë¸**: AOT, DeepFillv2, LaMa, DSI, ICT ë“±
* **ì£¼ìš” ì„±ëŠ¥ ì§€í‘œ**: ì‚¬ìš©ì ì„ í˜¸ë„ íˆ¬í‘œ(User Study), LPIPS

í•µì‹¬ ê´€ì°°(ë¦¬í˜ì¸íŒ… ê´€ì ):

* **Resampling íšŸìˆ˜ (n)**ì´ ëŠ˜ìˆ˜ë¡ ê²½ê³„ ì¡°í™”/ì˜ë¯¸ë¡ ì´ ì¢‹ì•„ì§€ê³ , íš¨ê³¼ëŠ” ëŒ€ëµ (n\approx10) ê·¼ì²˜ì—ì„œ í¬í™”(Fig.3).
* â€œSlowing down(í™•ì‚° stepë§Œ ëŠ˜ë¦¬ëŠ”)â€ ëŒ€ë¹„, **ë™ì¼ ê³„ì‚° ì˜ˆì‚°ì—ì„œ resamplingì´ ë” ê°œì„ **(Table 2 / Fig.7)

  * ì¦‰, RePaintì˜ ì´ë“ì€ ë‹¨ìˆœíˆ â€œë” ì˜¤ë˜ ëŒë ¤ì„œâ€ê°€ ì•„ë‹ˆë¼ **ì™•ë³µ resampling ìì²´ê°€ ì¡°í™”ì— ì§ì ‘ ê¸°ì—¬**.

ëŒ€í‘œ ì„¤ì •(Implementation): (T=250), resampling (r\approx10), jump size (j\approx10)ì„ ì‚¬ìš©.

---

## âœ… ì¥ì  ë° í•œê³„

## **ì¥ì **:

* **ë§ˆìŠ¤í¬-ë¹„ì˜ì¡´(mask-agnostic)**: ì¸í˜ì¸íŒ…ìš© ë³„ë„ í•™ìŠµ ì—†ì´ ì–´ë–¤ ë§ˆìŠ¤í¬ì—ë„ ì ìš© ê°€ëŠ¥
* **ì˜ë¯¸ë¡ ì  ìƒì„± + ê³ í’ˆì§ˆ ë””í…Œì¼**: DDPM prior ë•ë¶„ì— texture ë³µì‚¬ì—ë§Œ ë¨¸ë¬¼ì§€ ì•Šê³  â€œê·¸ëŸ´ë“¯í•œâ€ ìƒì„±
* **ë‹¤ì–‘ì„±**: í™•ì‚° ìƒ˜í”Œë§ì˜ í™•ë¥ ì„±ìœ¼ë¡œ ì—¬ëŸ¬ í›„ë³´ ìƒì„± ê°€ëŠ¥

## **í•œê³„ ë° ê°œì„  ê°€ëŠ¥ì„±**:

* **ì†ë„/ë¹„ìš©**: DDPM ìƒ˜í”Œë§(íŠ¹íˆ resampling/jump)ìœ¼ë¡œ ì¸í¼ëŸ°ìŠ¤ê°€ ëŠë¦¼
* **ë°ì´í„° ë°”ì´ì–´ìŠ¤**: ImageNet í•™ìŠµ prior íŠ¹ì„±ìœ¼ë¡œ íŠ¹ì • ê°ì²´(ì˜ˆ: ê°œ)ê°€ ê³¼ë„í•˜ê²Œ ë“±ì¥í•˜ëŠ” ì‹¤íŒ¨ ì‚¬ë¡€ ë³´ê³ (Failure case)
* **ì •ëŸ‰í‰ê°€ ë‚œì **: extreme maskì—ì„œ â€œì •ë‹µê³¼ ë‹¤ë¥¸ë° ê·¸ëŸ´ë“¯í•œâ€ ìƒì„±ì´ ê°€ëŠ¥í•´ LPIPS ê°™ì€ ì§€í‘œê°€ ë¶ˆë¦¬í•˜ê²Œ ë‚˜ì˜¬ ìˆ˜ ìˆìŒ

---

## ğŸ§  TL;DR â€“ í•œëˆˆì— ìš”ì•½

> **í•µì‹¬ ê¸°ì—¬ í•œ ì¤„**: â€œUnconditional DDPMì„ ê·¸ëŒ€ë¡œ ì“°ë˜, **known í”½ì…€ì„ ë¶„í¬ì ìœ¼ë¡œ ì£¼ì…**í•˜ê³  **í™•ì‚°ì‹œê°„ ì™•ë³µ(resampling/jump)**ìœ¼ë¡œ ì¡°í™”ë¥¼ ê°•í™”í•´ mask-agnostic inpaintingì„ ë‹¬ì„±.â€

| êµ¬ì„± ìš”ì†Œ  | ì„¤ëª…                                                                                                 |                                       |                |
| ------ | -------------------------------------------------------------------------------------------------- | ------------------------------------- | -------------- |
| í•µì‹¬ ëª¨ë“ˆ  | (1) Known-region injection (Eq.8) (2) Resampling + Jump schedule (Algorithm 1 + Appendix schedule) |                                       |                |
| í•™ìŠµ ì „ëµ  | ì¸í˜ì¸íŒ… í•™ìŠµ ì—†ìŒ(ì‚¬ì „í•™ìŠµ unconditional DDPM ì‚¬ìš©)                                                             |                                       |                |
| ì „ì´ ë°©ì‹  | ì—­í™•ì‚° stepë§ˆë‹¤ knownì€ (q(x_t                                                                           | x_0))ë¡œ ìƒ˜í”Œ, unknownì€ (p_\theta(x_{t-1} | x_t))ë¡œ ìƒ˜í”Œ í›„ í•©ì„± |
| ì„±ëŠ¥/íš¨ìœ¨ì„± | í’ˆì§ˆ/ì¼ë°˜í™” ê°•í•¨ â†” ìƒ˜í”Œë§ ë¹„ìš© í¼(íŠ¹íˆ resampling/jump)                                                           |                                       |                |

---

## ğŸ”— ì°¸ê³  ë§í¬ (References)

* [ğŸ“„ arXiv ë…¼ë¬¸] (RePaint: 2201.09865)
* [ğŸ’» GitHub] git.io/RePaint
* [ğŸ“ˆ Papers with Code] (RePaint inpainting)

---

## ë‹¤ìŒ ë…¼ë¬¸:

(ì´ í˜•ì‹ ìœ ì§€)
